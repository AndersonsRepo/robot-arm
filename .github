version: 1

# --- Core behavior -----------------------------------------------------------
reviews:
  enable: true
  summarize: true                 # Adds a PR summary comment
  suggest_fixes: true             # Inline fix suggestions where safe
  style: concise                  # Short, actionable comments
  max_comments_per_file: 25
  nitpicks: false                 # Avoid super minor comments

  # Focus reviews where it matters for the telemanipulator
  languages: [python, cpp, c, yaml, markdown]

  paths:
    include:
      - "src/**"                  # IK/FK, kinematics, planners
      - "firmware/**"             # MCU/Arduino/embedded code
      - "sim/**"                  # PyBullet/ROS sim, test rigs
      - "urdf/**"                 # Robot model files
      - "config/**"               # DH params, joint limits, PID gains
      - "scripts/**"              # build, tooling, data-gen
      - "tests/**"                # unit/integration tests
    exclude:
      - "docs/**"
      - "cad/**"
      - "hardware/**"
      - "BOM/**"
      - "**/*.stl"
      - "**/*.step"
      - "**/*.pdf"
      - "**/.ipynb_checkpoints/**"
      - "**/__pycache__/**"
      - "**/*.log"

  # Stronger scrutiny on safety-critical configs
  rules:
    - name: "Safety-critical parameters change"
      description: "Flag changes to joint limits, DH params, PID gains, or calibration."
      triggers:
        paths:
          - "config/joint_limits.*"
          - "config/dh_params.*"
          - "config/pid/**"
          - "config/calibration/**"
      require_explanation: true
      block_if_failed: true

  # Ask authors for test evidence on risky areas
  request_test_plan:
    enable: true
    when_paths_change:
      - "src/**"
      - "firmware/**"
      - "sim/**"
      - "config/**"
    message: |
      Please include:
      - What scenarios you tested (workspace edges, singularities, saturation).
      - How you validated IK/FK correctness (numerical checks or sim).
      - Any hardware safeguards (limit switches, soft limits).

# --- Quality bars ------------------------------------------------------------
checks:
  require_unit_tests: true
  prefer_pytest: true
  min_coverage: 0                 # Set >0 once you have coverage reporting
  large_diff_warning_threshold: 800

# --- Style & consistency -----------------------------------------------------
conventions:
  enforce_conventional_commits: true
  commit_types: [feat, fix, docs, chore, refactor, test, ci, perf]
  pr_title_format: "type(scope): summary"
  ask_for_missing_titles: true

# --- Labels (auto-label PRs by area) ----------------------------------------
labels:
  enable: true
  rules:
    - name: "area/kinematics"
      paths: ["src/**", "config/dh_params.*", "urdf/**"]
      apply: ["area: kinematics"]
    - name: "area/firmware"
      paths: ["firmware/**"]
      apply: ["area: firmware"]
    - name: "area/simulation"
      paths: ["sim/**", "scripts/sim_*"]
      apply: ["area: simulation"]
    - name: "area/config"
      paths: ["config/**"]
      apply: ["area: config"]

# --- Security & secrets ------------------------------------------------------
security:
  secrets_scan: true
  disallow_patterns:
    - "API_KEY="
    - "PRIVATE_KEY"
    - "BEGIN RSA PRIVATE KEY"
    - "BEGIN OPENSSH PRIVATE KEY"

# --- Release notes / changelog ----------------------------------------------
release_notes:
  enable: true
  template: |
    ## Robot-Arm Release Notes
    **Kinematics/Planning**
    $PR_TITLES_MATCHING(src/**|urdf/**|config/dh_params.*)

    **Firmware & Drivers**
    $PR_TITLES_MATCHING(firmware/**)

    **Simulation & Tooling**
    $PR_TITLES_MATCHING(sim/**|scripts/**)

    **Bug fixes & misc**
    $OTHER_PR_TITLES

    _Generated by CodeRabbit_
